<!DOCTYPE html>
<html>

<head>
    <title>Move Brick</title>
    <link href="./style.css" rel="stylesheet">
</head>

<body>
    <canvas id="canv"></canvas>
    <!-- <script src="Utilities.js"></script> -->
    <!-- <script src="Time.js"></script> -->
    <!-- <script src="Component.js"></script> -->
    <!-- <script src="GameObject.js"></script> -->
    <!-- <script src="PlayerDrawComponent.js"></script> -->
    <!-- <script src="PlayerUpdateComponent.js"></script> -->
    <!-- <script src="PlayerGameObject.js"></script> -->
    <!-- <script src="EnemyDrawComponent.js"></script> -->
    <!-- <script src="EnemyUpdateComponent.js"></script> -->
    <!-- <script src="EnemyGameObject.js"></script> -->
    <!-- <script src="BulletDrawComponent.js"></script> -->
    <!-- <script src="BulletUpdateComponent.js"></script> -->
    <!-- <script src="BulletGameObject.js"></script> -->

    <script type="module">
        "use strict"
        //generic engine code
        import {getCanvas, detectKeyDown, detectKeyUp, getRandomX, getRandomY} from "./engine/Utilities.js"
        import Time from "./engine/Time.js"
        import GameObject from "./engine/GameObject.js"
        import Component from "./engine/Component.js"
        import Input from "./engine/Input.js"

        //game specific code
        import PlayerGameObject from "./game/PlayerGameObject.js"
        import PlayerUpdateComponent from "./game/PlayerUpdateComponent.js"
        import PlayerDrawComponent from "./game/PlayerDrawComponent.js"
        
        import EnemyGameObject from "./game/EnemyGameObject.js"
        import EnemyUpdateComponent from "./game/EnemyUpdateComponent.js"
        import EnemyDrawComponent from "./game/EnemyDrawComponent.js"
        
        import BulletGameObject from "./game/BulletGameObject.js"
        import BulletUpdateComponent from "./game/BulletUpdateComponent.js"
        import BulletDrawComponent from "./game/BulletDrawComponent.js"



        //setup the canvas
        let { canvas, ctx } = getCanvas()
        let gameObjects = []

        //check for arrow key input
        document.addEventListener("keydown", (e) => detectKeyDown(e))
        document.addEventListener("keyup", (e) => detectKeyUp(e))
        // let leftArrowPress = false
        // let rightArrowPress = false
        // let upArrowPress = false
        // let downArrowPress = false

        //define the model
        let playerX = canvas.width / 2
        let playerY = canvas.height / 1.25
        let playerW = 50
        let playerH = 50
        


        //create player
        let player = new PlayerGameObject(playerX, playerY, playerW, playerH)
        gameObjects.push(player)

        //create enemies
        let numEnemies = 5
        for (let i = 0; i < numEnemies; i++) {
            let offset = (canvas.width / 5)
            let enemyX = 100 + offset * i
            let enemyY = 0
            let enemyW = 25
            let enemyH = 25

            gameObjects.push(new EnemyGameObject(enemyX, enemyY, enemyW, enemyH))
        }

        //create stationary bullets
        let numBullets = 5
        for (let i = 0; i < numBullets; i++) {
            let offset = (canvas.width / 5)
            //bulletX looks weird, but this positions bullets right in the center of enemies
            let bulletX = 50 + (canvas.width / 5) * i + 62
            let bulletY = 10
            let bulletW = 5
            let bulletH = 25

            //create a test moving projectile to get timint down
            gameObjects.push(new BulletGameObject(bulletX, bulletY, bulletW, bulletH, getRandomX(0,2), getRandomY(2,0)))

            //below are 5 bullets that stay stationary just to simulate where they will be firing from
            gameObjects.push(new BulletGameObject(bulletX, bulletY, bulletW, bulletH, null, null))
        }

        //continusously push new bullet objects to screen
        let num = 5
        for (let j = 0; j < num; j++) {
            let offset = (canvas.width / 5)
            let bulletX = 50 + offset * j + 62
            let bulletY = 10
            let bulletW = 5
            let bulletH = 25

            //setInterval(gameObjects.push(new BulletGameObject(bulletX, bulletY, bulletW, bulletH, getRandomX(0,5), getRandomY(5,0))), Time.secondsBetweenBullets)

        }
        //setTimeinterval(create new bullet game object here, Time.secondsBetweenBullet)




        function draw() {
            //draw background
            ctx.fillStyle = "grey"
            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)

            //draw player
            player.draw(ctx)

            //draw enemies
            for (let enemy of gameObjects) {
                enemy.draw(ctx)
            }

            //draw bullets
            for (let bullet of gameObjects) {
                bullet.draw(ctx)
            }

        }

        function update() {
            player.update()
            for (let bullet of gameObjects) {
                bullet.update()
            }
            //currently no enemy update - don't know what to do yet
        }

        function tick() {
            update()
            draw()
            Time.timePassed += Time.secondsBetweenFrame
        }


        //run it
        setInterval(tick, Time.millisecondsBetweenFrames)

    </script>


</body>